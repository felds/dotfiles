#!/usr/bin/env sh

# more details at:
# http://symfony.com/doc/current/book/installation.html#book-installation-permissions

# check if it's an sf3 installation
if [ ! -f bin/console ]; then
    echo "✘  this is not a Symfony3 project"
    exit 2
fi

# check if the mandatory folders exist
DIRS="var/cache var/logs var/sessions $@"
echo $DIRS
for DIR in $DIRS; do
    if [ ! -d $DIR ]; then
        mkdir -p $DIR
        echo "→ Created $DIR dir" >&2
    fi
done


# clen up cache dir
rm -fr var/cache/*
echo "→ Emptied var/cache dir" >&2

# clen up cache dir
rm -fr var/sessions/*
echo "→ Emptied var/sessions dir" >&2


# set the permissions
APACHEUSER=$(ps aux | grep -E '[a]pache|[h]ttpd' | grep -v root | head -1 | cut -d\  -f1)
chmod -R +a "$APACHEUSER allow delete,write,append,file_inherit,directory_inherit" $DIRS
chmod -R +a "`whoami` allow delete,write,append,file_inherit,directory_inherit" $DIRS


# horray!
echo "✔  all set!" >&2
exit 0
